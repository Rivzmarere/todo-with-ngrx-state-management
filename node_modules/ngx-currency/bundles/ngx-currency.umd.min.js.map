{"version":3,"sources":["ng://ngx-currency/src/currency-mask.config.ts","ng://ngx-currency/src/input.manager.ts","ng://ngx-currency/src/input.service.ts","ng://ngx-currency/src/input.handler.ts","ng://ngx-currency/src/currency-mask.directive.ts","ng://ngx-currency/src/currency-mask.module.ts"],"names":["CurrencyMaskInputMode","CURRENCY_MASK_CONFIG","InjectionToken","InputManager","htmlInputElement","this","prototype","setCursorAt","position","setSelectionRange","focus","createTextRange","textRange","collapse","moveEnd","moveStart","select","updateValueAndCursor","newRawValue","oldLength","selectionStart","rawValue","length","Object","defineProperty","haventReachedMaxLength","replace","maxLength","inputSelection","selectionEnd","haveNumberSelected","value","substring","match","startWithZero","range","document","selection","createRange","parentElement","lenght","normalizedValue","startRange","moveToBookmark","getBookmark","endRange","compareEndPoints","slice","split","_storedRawValue","InputService","options","SINGLE_DIGIT_REGEX","RegExp","ONLY_NUMBERS_REGEX","PER_AR_NUMBER","Map","inputManager","initialize","set","addNumber","keyCode","_a","decimal","precision","inputMode","keyChar","String","fromCharCode","isDecimalChar","rawValueStart","rawValueEnd","inDecimalPortion","indexOf","NATURAL","newValue","nextSelectionStart","thousands","test","updateFieldValue","applyMask","undefined","isNumber","disablePadAndTrim","allowNegative","prefix","suffix","min","max","onlyNumbers","Number","toFixed","padOrTrimPrecision","integerPart","integerValue","parseInt","startsWith","decimalPart","decimalValue","isNegative","isNullOrUndefined","Math","repeat","decimalIndex","lastIndexOf","decimalPortion","actualPrecision","i","clearMask","isNullable","forEach","val","key","re","parseFloat","changeToNegative","charAt","changeToPositive","removeNumber","suffixStart","shiftSelection","insertChars","isCursorInDecimals","isCursorImmediatelyAfterDecimalPoint","substr","replacedDecimalCount","selectionFromEnd","updateOptions","prefixLength","suffixLength","nullable","canInputMoreNumbers","storedRawValue","InputHandler","inputService","handleCut","event","_this","setTimeout","setValue","onModelChange","handleInput","charCodeAt","rawValueLength","storedRawValueLength","abs","timer","handleKeypressImpl","handleKeydown","which","charCode","preventDefault","clearValue","handleKeypress","ctrlKey","handlePaste","getOnModelChange","setOnModelChange","callbackFunction","getOnModelTouched","onModelTouched","setOnModelTouched","callback","delayMillis","CURRENCYMASKDIRECTIVE_VALUE_ACCESSOR","provide","NG_VALUE_ACCESSOR","useExisting","forwardRef","CurrencyMaskDirective","multi","currencyMaskConfig","elementRef","keyValueDiffers","optionsTemplate","align","allowZero","FINANCIAL","keyValueDiffer","find","create","ngAfterViewInit","nativeElement","style","textAlign","ngDoCheck","diff","inputHandler","assign","ngOnInit","handleBlur","apply","isChromeAndroid","isReadOnly","handleDrop","navigator","userAgent","hasAttribute","registerOnChange","registerOnTouched","setDisabledState","disabled","writeValue","Optional","type","Inject","args","ElementRef","KeyValueDiffers","Directive","selector","providers","Input","HostListener","NgxCurrencyModule","forRoot","config","ngModule","useValue","NgModule","imports","CommonModule","FormsModule","declarations","exports"],"mappings":"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","sourcesContent":["import {InjectionToken} from \"@angular/core\";\n\nexport interface CurrencyMaskConfig {\n  align: string;\n  allowNegative: boolean;\n  allowZero: boolean;\n  decimal: string;\n  precision: number;\n  prefix: string;\n  suffix: string;\n  thousands: string;\n  nullable: boolean;\n  min?: number;\n  max?: number;\n  inputMode? : CurrencyMaskInputMode;\n}\n\nexport enum CurrencyMaskInputMode {\n  FINANCIAL,\n  NATURAL,\n}\n\nexport let CURRENCY_MASK_CONFIG = new InjectionToken<CurrencyMaskConfig>(\"currency.mask.config\");\n","export class InputManager {\n\n    private _storedRawValue: string;\n\n    constructor(private htmlInputElement: any) {\n    }\n\n    setCursorAt(position: number): void {\n        if (this.htmlInputElement.setSelectionRange) {\n            this.htmlInputElement.focus();\n            this.htmlInputElement.setSelectionRange(position, position);\n        } else if (this.htmlInputElement.createTextRange) {\n            let textRange = this.htmlInputElement.createTextRange();\n            textRange.collapse(true);\n            textRange.moveEnd(\"character\", position);\n            textRange.moveStart(\"character\", position);\n            textRange.select();\n        }\n    }\n\n    updateValueAndCursor(newRawValue: string, oldLength: number, selectionStart: number): void {\n        this.rawValue = newRawValue;\n        let newLength = newRawValue.length;\n        selectionStart = selectionStart - (oldLength - newLength);\n        this.setCursorAt(selectionStart);\n    }\n\n    get canInputMoreNumbers(): boolean {\n        let onlyNumbers = this.rawValue.replace(/[^0-9\\u0660-\\u0669\\u06F0-\\u06F9]/g, \"\");\n        let haventReachedMaxLength = !(onlyNumbers.length >= this.htmlInputElement.maxLength && this.htmlInputElement.maxLength >= 0);\n        let selectionStart = this.inputSelection.selectionStart;\n        let selectionEnd = this.inputSelection.selectionEnd;\n        let haveNumberSelected = !!(selectionStart != selectionEnd &&\n                                    this.htmlInputElement.value.substring(selectionStart, selectionEnd).match(/[^0-9\\u0660-\\u0669\\u06F0-\\u06F9]/));\n        let startWithZero = (this.htmlInputElement.value.substring(0, 1) == \"0\");\n        return haventReachedMaxLength || haveNumberSelected || startWithZero;\n    }\n\n    get inputSelection(): any {\n        let selectionStart = 0;\n        let selectionEnd = 0;\n\n        if (typeof this.htmlInputElement.selectionStart == \"number\" && typeof this.htmlInputElement.selectionEnd == \"number\") {\n            selectionStart = this.htmlInputElement.selectionStart;\n            selectionEnd = this.htmlInputElement.selectionEnd;\n        } else {\n            let range = (<any>document).selection.createRange();\n\n            if (range && range.parentElement() == this.htmlInputElement) {\n                let lenght = this.htmlInputElement.value.length;\n                let normalizedValue = this.htmlInputElement.value.replace(/\\r\\n/g, \"\\n\");\n                let startRange = this.htmlInputElement.createTextRange();\n                startRange.moveToBookmark(range.getBookmark());\n                let endRange = this.htmlInputElement.createTextRange();\n                endRange.collapse(false);\n\n                if (startRange.compareEndPoints(\"StartToEnd\", endRange) > -1) {\n                    selectionStart = selectionEnd = lenght;\n                } else {\n                    selectionStart = -startRange.moveStart(\"character\", -lenght);\n                    selectionStart += normalizedValue.slice(0, selectionStart).split(\"\\n\").length - 1;\n\n                    if (startRange.compareEndPoints(\"EndToEnd\", endRange) > -1) {\n                        selectionEnd = lenght;\n                    } else {\n                        selectionEnd = -startRange.moveEnd(\"character\", -lenght);\n                        selectionEnd += normalizedValue.slice(0, selectionEnd).split(\"\\n\").length - 1;\n                    }\n                }\n            }\n        }\n\n        return {\n            selectionStart: selectionStart,\n            selectionEnd: selectionEnd\n        };\n    }\n\n    get rawValue(): string {\n        return this.htmlInputElement && this.htmlInputElement.value;\n    }\n\n    set rawValue(value: string) {\n        this._storedRawValue = value;\n\n        if (this.htmlInputElement) {\n            this.htmlInputElement.value = value;\n        }\n    }\n\n    get storedRawValue(): string {\n        return this._storedRawValue || '';\n    }\n}\n","import { InputManager } from \"./input.manager\";\nimport { CurrencyMaskConfig, CurrencyMaskInputMode } from \"./currency-mask.config\";\n\nexport class InputService {\n    private SINGLE_DIGIT_REGEX: RegExp = new RegExp(/^[0-9\\u0660-\\u0669\\u06F0-\\u06F9]$/);\n    private ONLY_NUMBERS_REGEX: RegExp = new RegExp(/[^0-9\\u0660-\\u0669\\u06F0-\\u06F9]/g);\n\n    PER_AR_NUMBER: Map<string, string> = new Map<string, string>();\n\n    initialize() {\n        this.PER_AR_NUMBER.set(\"\\u06F0\", \"0\");\n        this.PER_AR_NUMBER.set(\"\\u06F1\", \"1\");\n        this.PER_AR_NUMBER.set(\"\\u06F2\", \"2\");\n        this.PER_AR_NUMBER.set(\"\\u06F3\", \"3\");\n        this.PER_AR_NUMBER.set(\"\\u06F4\", \"4\");\n        this.PER_AR_NUMBER.set(\"\\u06F5\", \"5\");\n        this.PER_AR_NUMBER.set(\"\\u06F6\", \"6\");\n        this.PER_AR_NUMBER.set(\"\\u06F7\", \"7\");\n        this.PER_AR_NUMBER.set(\"\\u06F8\", \"8\");\n        this.PER_AR_NUMBER.set(\"\\u06F9\", \"9\");\n\n        this.PER_AR_NUMBER.set(\"\\u0660\", \"0\");\n        this.PER_AR_NUMBER.set(\"\\u0661\", \"1\");\n        this.PER_AR_NUMBER.set(\"\\u0662\", \"2\");\n        this.PER_AR_NUMBER.set(\"\\u0663\", \"3\");\n        this.PER_AR_NUMBER.set(\"\\u0664\", \"4\");\n        this.PER_AR_NUMBER.set(\"\\u0665\", \"5\");\n        this.PER_AR_NUMBER.set(\"\\u0666\", \"6\");\n        this.PER_AR_NUMBER.set(\"\\u0667\", \"7\");\n        this.PER_AR_NUMBER.set(\"\\u0668\", \"8\");\n        this.PER_AR_NUMBER.set(\"\\u0669\", \"9\");\n    }\n\n    inputManager: InputManager;\n\n    constructor(private htmlInputElement: any, private options: CurrencyMaskConfig) {\n        this.inputManager = new InputManager(htmlInputElement);\n        this.initialize()\n    }\n\n    addNumber(keyCode: number): void {\n        const {decimal, precision, inputMode} = this.options;\n        let keyChar = String.fromCharCode(keyCode);\n        const isDecimalChar = keyChar === this.options.decimal;\n\n        if (!this.rawValue) {\n            this.rawValue = this.applyMask(false, keyChar);\n            let selectionStart:number = undefined;\n            if (inputMode === CurrencyMaskInputMode.NATURAL && precision > 0) {\n                selectionStart = this.rawValue.indexOf(decimal);\n                if (isDecimalChar) {\n                    selectionStart++;\n                }\n            }\n            this.updateFieldValue(selectionStart);\n        } else {\n            let selectionStart = this.inputSelection.selectionStart;\n            let selectionEnd = this.inputSelection.selectionEnd;\n            const rawValueStart = this.rawValue.substring(0, selectionStart);\n            let rawValueEnd = this.rawValue.substring(selectionEnd, this.rawValue.length);\n\n            // In natural mode, replace decimals instead of shifting them.\n            const inDecimalPortion = rawValueStart.indexOf(decimal) !== -1;\n            if (inputMode === CurrencyMaskInputMode.NATURAL && inDecimalPortion && selectionStart === selectionEnd) {\n              rawValueEnd = rawValueEnd.substring(1);\n            }\n\n            const newValue = rawValueStart + keyChar + rawValueEnd;\n            let nextSelectionStart = selectionStart + 1;\n            const isDecimalOrThousands = isDecimalChar || keyChar === this.options.thousands;\n            if (isDecimalOrThousands && keyChar === rawValueEnd[0]) {\n                // If the cursor is just before the decimal or thousands separator and the user types the\n                // decimal or thousands separator, move the cursor past it.\n                nextSelectionStart++;\n            } else if (!this.SINGLE_DIGIT_REGEX.test(keyChar)) {\n                // Ignore other non-numbers.\n                return;\n            }\n\n            this.rawValue = newValue;\n            this.updateFieldValue(nextSelectionStart);\n        }\n    }\n\n    applyMask(isNumber: boolean, rawValue: string, disablePadAndTrim = false): string {\n        let {allowNegative, decimal, precision, prefix, suffix, thousands, min, max, inputMode} = this.options;\n\n        rawValue = isNumber ? new Number(rawValue).toFixed(precision) : rawValue;\n        let onlyNumbers = rawValue.replace(this.ONLY_NUMBERS_REGEX, \"\");\n\n        if (!onlyNumbers && rawValue !== decimal) {\n            return \"\";\n        }\n\n        if (inputMode === CurrencyMaskInputMode.NATURAL && !isNumber && !disablePadAndTrim) {\n            rawValue = this.padOrTrimPrecision(rawValue);\n            onlyNumbers = rawValue.replace(this.ONLY_NUMBERS_REGEX, \"\");\n        }\n\n        let integerPart = onlyNumbers.slice(0, onlyNumbers.length - precision)\n            .replace(/^\\u0660*/g, \"\")\n            .replace(/^\\u06F0*/g, \"\")\n            .replace(/^0*/g, \"\");\n\n        if (integerPart == \"\") {\n            integerPart = \"0\";\n        }\n        let integerValue = parseInt(integerPart);\n\n        integerPart = integerPart.replace(/\\B(?=([0-9\\u0660-\\u0669\\u06F0-\\u06F9]{3})+(?![0-9\\u0660-\\u0669\\u06F0-\\u06F9]))/g, thousands);\n        if (thousands && integerPart.startsWith(thousands)) {\n            integerPart = integerPart.substring(1);\n        }\n\n        let newRawValue = integerPart;\n        let decimalPart = onlyNumbers.slice(onlyNumbers.length - precision);\n        let decimalValue = parseInt(decimalPart) || 0;\n\n        let isNegative = rawValue.indexOf(\"-\") > -1;\n\n        // Ensure max is at least as large as min.\n        max = (this.isNullOrUndefined(max) || this.isNullOrUndefined(min)) ? max : Math.max(max, min);\n\n        // Restrict to the min and max values.\n        let newValue = integerValue + (decimalValue / 100);\n        newValue = isNegative ? -newValue : newValue;\n        if (!this.isNullOrUndefined(max) && newValue > max) {\n            return this.applyMask(true, max + '');\n        } else if (!this.isNullOrUndefined(min) && newValue < min) {\n            return this.applyMask(true, min + '');\n        }\n\n        if (precision > 0) {\n            if (newRawValue == \"0\" && decimalPart.length < precision) {\n                newRawValue += decimal + \"0\".repeat(precision - 1) + decimalPart;\n            } else {\n                newRawValue += decimal + decimalPart;\n            }\n        }\n\n        let isZero = newValue == 0;\n        let operator = (isNegative && allowNegative && !isZero) ? \"-\" : \"\";\n        return operator + prefix + newRawValue + suffix;\n    }\n\n    padOrTrimPrecision(rawValue: string): string {\n        let {decimal, precision} = this.options;\n\n        let decimalIndex = rawValue.lastIndexOf(decimal);\n        if (decimalIndex === -1) {\n            decimalIndex = rawValue.length;\n            rawValue += decimal;\n        }\n\n        let decimalPortion = rawValue.substring(decimalIndex).replace(this.ONLY_NUMBERS_REGEX, \"\");\n        const actualPrecision = decimalPortion.length;\n        if (actualPrecision < precision) {\n            for (let i = actualPrecision; i < precision; i++) {\n                decimalPortion += '0';\n            }\n        } else if (actualPrecision > precision) {\n            decimalPortion = decimalPortion.substring(0, decimalPortion.length + precision - actualPrecision);\n        }\n\n        return rawValue.substring(0, decimalIndex) + decimal + decimalPortion;\n    }\n\n    clearMask(rawValue: string): number {\n        if (this.isNullable() && rawValue === \"\")\n            return null;\n\n        let value = (rawValue || \"0\").replace(this.options.prefix, \"\").replace(this.options.suffix, \"\");\n\n        if (this.options.thousands) {\n            value = value.replace(new RegExp(\"\\\\\" + this.options.thousands, \"g\"), \"\");\n        }\n\n        if (this.options.decimal) {\n            value = value.replace(this.options.decimal, \".\");\n        }\n\n        this.PER_AR_NUMBER.forEach((val: string, key: string) => {\n            const re = new RegExp(key, \"g\");\n            value = value.replace(re, val);\n        });\n        return parseFloat(value);\n    }\n\n    changeToNegative(): void {\n        if (this.options.allowNegative && this.rawValue != \"\" && this.rawValue.charAt(0) != \"-\" && this.value != 0) {\n            // Apply the mask to ensure the min and max values are enforced.\n            this.rawValue = this.applyMask(false, \"-\" + this.rawValue);\n        }\n    }\n\n    changeToPositive(): void {\n        // Apply the mask to ensure the min and max values are enforced.\n        this.rawValue = this.applyMask(false, this.rawValue.replace(\"-\", \"\"));\n    }\n\n    removeNumber(keyCode: number): void {\n        let {decimal, thousands, prefix, suffix, inputMode} = this.options;\n\n        if (this.isNullable() && this.value == 0) {\n            this.rawValue = null;\n            return;\n        }\n\n        let selectionEnd = this.inputSelection.selectionEnd;\n        let selectionStart = this.inputSelection.selectionStart;\n\n        const suffixStart = this.rawValue.length - suffix.length;\n        selectionEnd = Math.min(suffixStart, Math.max(selectionEnd, prefix.length));\n        selectionStart = Math.min(suffixStart, Math.max(selectionStart, prefix.length));\n\n        // Check if selection was entirely in the prefix or suffix. \n        if (selectionStart === selectionEnd &&\n            this.inputSelection.selectionStart !== this.inputSelection.selectionEnd) {\n            this.updateFieldValue(selectionStart);\n            return;\n        }\n\n        let decimalIndex = this.rawValue.indexOf(decimal);\n        if (decimalIndex === -1) {\n            decimalIndex = this.rawValue.length;\n        }\n\n        let shiftSelection = 0;\n        let insertChars = '';\n        const isCursorInDecimals = decimalIndex < selectionEnd;\n        const isCursorImmediatelyAfterDecimalPoint = decimalIndex + 1 === selectionEnd;\n        if (selectionEnd === selectionStart) {\n            if (keyCode == 8) {\n                if (selectionStart <= prefix.length) {\n                    return;\n                }\n                selectionStart--;\n\n                // If previous char isn't a number, go back one more.\n                if (!this.rawValue.substr(selectionStart, 1).match(/\\d/)) {\n                    selectionStart--;\n                }\n\n                // In natural mode, jump backwards when in decimal portion of number.\n                if (inputMode === CurrencyMaskInputMode.NATURAL && isCursorInDecimals) {\n                    shiftSelection = -1;\n                    // when removing a single whole number, replace it with 0\n                    if (isCursorImmediatelyAfterDecimalPoint && this.value < 10 && this.value > -10) {\n                        insertChars += '0';\n                    }\n                }\n            } else if (keyCode == 46 || keyCode == 63272) {\n                if (selectionStart === suffixStart) {\n                    return;\n                }\n                selectionEnd++;\n\n                // If next char isn't a number, go one more.\n                if (!this.rawValue.substr(selectionStart, 1).match(/\\d/)) {\n                    selectionStart++;\n                    selectionEnd++;\n                }\n            }\n        }\n\n        // In natural mode, replace decimals with 0s.\n        if (inputMode === CurrencyMaskInputMode.NATURAL && selectionStart > decimalIndex) {\n            const replacedDecimalCount = selectionEnd - selectionStart;\n            for (let i = 0; i < replacedDecimalCount; i++) {\n                insertChars += '0';\n            }\n        }\n\n        let selectionFromEnd = this.rawValue.length - selectionEnd;\n        this.rawValue = this.rawValue.substring(0, selectionStart) + insertChars + this.rawValue.substring(selectionEnd);\n\n        // Remove leading thousand separator from raw value.\n        const startChar = this.rawValue.substr(prefix.length, 1);\n        if (startChar === thousands) {\n            this.rawValue = this.rawValue.substring(0, prefix.length) + this.rawValue.substring(prefix.length + 1);\n            selectionFromEnd = Math.min(selectionFromEnd, this.rawValue.length - prefix.length);\n        }\n\n        this.updateFieldValue(this.rawValue.length - selectionFromEnd + shiftSelection, true);\n    }\n\n    updateFieldValue(selectionStart?: number, disablePadAndTrim = false): void {\n        let newRawValue = this.applyMask(false, this.rawValue || \"\", disablePadAndTrim);\n        selectionStart = selectionStart == undefined ? this.rawValue.length : selectionStart;\n        selectionStart = Math.max(this.options.prefix.length, Math.min(selectionStart, this.rawValue.length - this.options.suffix.length));\n        this.inputManager.updateValueAndCursor(newRawValue, this.rawValue.length, selectionStart);\n    }\n\n    updateOptions(options: any): void {\n        let value: number = this.value;\n        this.options = options;\n        this.value = value;\n    }\n\n    prefixLength(): any {\n        return this.options.prefix.length;\n    }\n\n    suffixLength(): any {\n        return this.options.suffix.length;\n    }\n\n    isNullable() {\n        return this.options.nullable;\n    }\n\n    get canInputMoreNumbers(): boolean {\n        return this.inputManager.canInputMoreNumbers;\n    }\n\n    get inputSelection(): any {\n        return this.inputManager.inputSelection;\n    }\n\n    get rawValue(): string {\n        return this.inputManager.rawValue;\n    }\n\n    set rawValue(value: string) {\n        this.inputManager.rawValue = value;\n    }\n\n    get storedRawValue(): string {\n        return this.inputManager.storedRawValue;\n    }\n\n    get value(): number {\n        return this.clearMask(this.rawValue);\n    }\n\n    set value(value: number) {\n        this.rawValue = this.applyMask(true, \"\" + value);\n    }\n\n    private isNullOrUndefined(value: any) {\n        return value === null || value === undefined;\n    }\n}\n","import {InputService} from \"./input.service\";\n\nexport class InputHandler {\n\n    private inputService: InputService;\n    private onModelChange: Function;\n    private onModelTouched: Function;\n\n    constructor(htmlInputElement: HTMLInputElement, options: any) {\n        this.inputService = new InputService(htmlInputElement, options);\n    }\n\n    handleCut(event: any): void {\n        setTimeout(() => {\n            this.inputService.updateFieldValue();\n            this.setValue(this.inputService.value);\n            this.onModelChange(this.inputService.value);\n        }, 0);\n    }\n\n    handleInput(event: any): void {\n        let selectionStart = this.inputService.inputSelection.selectionStart;\n        let keyCode = this.inputService.rawValue.charCodeAt(selectionStart - 1);\n        let rawValueLength = this.inputService.rawValue.length;\n        let storedRawValueLength = this.inputService.storedRawValue.length;\n\n        if (Math.abs(rawValueLength - storedRawValueLength) != 1) {\n            this.inputService.updateFieldValue(selectionStart);\n            this.onModelChange(this.inputService.value);\n            return;\n        }\n\n        // Restore the old value.\n        this.inputService.rawValue = this.inputService.storedRawValue;\n\n        if (rawValueLength < storedRawValueLength) {\n            // Chrome Android seems to move the cursor in response to a backspace AFTER processing the\n            // input event, so we need to wrap this in a timeout.\n            this.timer(() => {\n                // Move the cursor to just after the deleted value.\n                this.inputService.updateFieldValue(selectionStart + 1);\n\n                // Then backspace it.\n                this.inputService.removeNumber(8);\n                this.onModelChange(this.inputService.value);  \n            }, 0);\n        }\n\n        if (rawValueLength > storedRawValueLength) {\n            // Move the cursor to just before the new value.\n            this.inputService.updateFieldValue(selectionStart - 1);\n\n            // Process the character like a keypress.\n            this.handleKeypressImpl(keyCode);\n        }\n    }\n\n    handleKeydown(event: any): void {\n        let keyCode = event.which || event.charCode || event.keyCode;\n        if (keyCode == 8 || keyCode == 46 || keyCode == 63272) {\n            event.preventDefault();\n\n            if (this.inputService.inputSelection.selectionStart <= this.inputService.prefixLength() &&\n                this.inputService.inputSelection.selectionEnd >= this.inputService.rawValue.length - this.inputService.suffixLength()) {\n                this.clearValue();\n            } else {\n                this.inputService.removeNumber(keyCode);\n                this.onModelChange(this.inputService.value);\n            }\n        }\n    }\n\n    clearValue() {\n        this.setValue(this.inputService.isNullable() ? null : 0);\n        this.onModelChange(this.inputService.value);\n    }\n\n    handleKeypress(event: any): void {\n        let keyCode = event.which || event.charCode || event.keyCode;\n        event.preventDefault();\n        if (keyCode === 97 && event.ctrlKey) {\n            return;\n        }\n\n        this.handleKeypressImpl(keyCode);\n    }\n\n    private handleKeypressImpl(keyCode: number): void {\n        switch (keyCode) {\n            case undefined:\n            case 9:\n            case 13:\n                return;\n            case 43:\n                this.inputService.changeToPositive();\n                break;\n            case 45:\n                this.inputService.changeToNegative();\n                break;\n            default:\n                if (this.inputService.canInputMoreNumbers) {\n                    let selectionRangeLength = Math.abs(this.inputService.inputSelection.selectionEnd - this.inputService.inputSelection.selectionStart);\n\n                    if (selectionRangeLength == this.inputService.rawValue.length) {\n                        this.setValue(null);\n                    }\n\n                    this.inputService.addNumber(keyCode);\n                }\n                break;\n        }\n\n        this.onModelChange(this.inputService.value);\n    }\n\n    handlePaste(event: any): void {\n        setTimeout(() => {\n            this.inputService.updateFieldValue();\n            this.setValue(this.inputService.value);\n            this.onModelChange(this.inputService.value);\n        }, 1);\n    }\n\n    updateOptions(options: any): void {\n        this.inputService.updateOptions(options);\n    }\n\n    getOnModelChange(): Function {\n        return this.onModelChange;\n    }\n\n    setOnModelChange(callbackFunction: Function): void {\n        this.onModelChange = callbackFunction;\n    }\n\n    getOnModelTouched(): Function {\n        return this.onModelTouched;\n    }\n\n    setOnModelTouched(callbackFunction: Function) {\n        this.onModelTouched = callbackFunction;\n    }\n\n    setValue(value: number): void {\n        this.inputService.value = value;\n    }\n\n    /**\n     * Passthrough to setTimeout that can be stubbed out in tests.\n     */\n    private timer(callback: () => void, delayMillis: number) {\n        setTimeout(callback, delayMillis);\n    }\n}\n","import {\n  AfterViewInit,\n  Directive,\n  DoCheck,\n  ElementRef,\n  forwardRef,\n  HostListener,\n  Inject,\n  KeyValueDiffer,\n  KeyValueDiffers,\n  Input,\n  OnInit,\n  Optional\n} from \"@angular/core\";\n\nimport {ControlValueAccessor, NG_VALUE_ACCESSOR} from \"@angular/forms\";\nimport {CurrencyMaskConfig, CURRENCY_MASK_CONFIG, CurrencyMaskInputMode} from \"./currency-mask.config\";\nimport {InputHandler} from \"./input.handler\";\n\nexport const CURRENCYMASKDIRECTIVE_VALUE_ACCESSOR: any = {\n  provide: NG_VALUE_ACCESSOR,\n  useExisting: forwardRef(() => CurrencyMaskDirective),\n  multi: true,\n};\n\n@Directive({\n    selector: \"[currencyMask]\",\n    providers: [CURRENCYMASKDIRECTIVE_VALUE_ACCESSOR]\n})\nexport class CurrencyMaskDirective implements AfterViewInit, ControlValueAccessor, DoCheck, OnInit {\n\n  @Input() options: Partial<CurrencyMaskConfig> = {};\n\n  public inputHandler: InputHandler;\n  public keyValueDiffer: KeyValueDiffer<any, any>;\n\n  public optionsTemplate: CurrencyMaskConfig = {\n      align: \"right\",\n      allowNegative: true,\n      allowZero: true,\n      decimal: \".\",\n      precision: 2,\n      prefix: \"$ \",\n      suffix: \"\",\n      thousands: \",\",\n      nullable: false,\n      inputMode: CurrencyMaskInputMode.FINANCIAL\n  };\n\n  constructor(@Optional() @Inject(CURRENCY_MASK_CONFIG) private currencyMaskConfig: CurrencyMaskConfig,\n                                                        private elementRef: ElementRef,\n                                                        private keyValueDiffers: KeyValueDiffers) {\n    if (currencyMaskConfig) {\n        this.optionsTemplate = currencyMaskConfig;\n    }\n\n    this.keyValueDiffer = keyValueDiffers.find({}).create();\n  }\n\n  ngAfterViewInit() {\n    this.elementRef.nativeElement.style.textAlign = this.options && this.options.align ? this.options.align : this.optionsTemplate.align;\n  }\n\n  ngDoCheck() {\n    if (this.keyValueDiffer.diff(this.options)) {\n      this.elementRef.nativeElement.style.textAlign = this.options.align ? this.options.align : this.optionsTemplate.align;\n      this.inputHandler.updateOptions((<any>Object).assign({}, this.optionsTemplate, this.options));\n    }\n  }\n\n  ngOnInit() {\n    this.inputHandler = new InputHandler(this.elementRef.nativeElement, (<any>Object).assign({}, this.optionsTemplate, this.options));\n  }\n\n  @HostListener(\"blur\", [\"$event\"])\n  handleBlur(event: any) {\n    this.inputHandler.getOnModelTouched().apply(event);\n  }\n\n  @HostListener(\"cut\", [\"$event\"])\n  handleCut(event: any) {\n    if (!this.isChromeAndroid()) {\n      !this.isReadOnly() && this.inputHandler.handleCut(event);\n    }\n  }\n\n  @HostListener(\"input\", [\"$event\"])\n  handleInput(event: any) {\n    if (this.isChromeAndroid()) {\n      !this.isReadOnly() && this.inputHandler.handleInput(event);\n    }\n  }\n\n  @HostListener(\"keydown\", [\"$event\"])\n  handleKeydown(event: any) {\n    if (!this.isChromeAndroid()) {\n      !this.isReadOnly() && this.inputHandler.handleKeydown(event);\n    }\n  }\n\n  @HostListener(\"keypress\", [\"$event\"])\n  handleKeypress(event: any) {\n    if (!this.isChromeAndroid()) {\n      !this.isReadOnly() && this.inputHandler.handleKeypress(event);\n    }\n  }\n\n  @HostListener(\"paste\", [\"$event\"])\n  handlePaste(event: any) {\n    if (!this.isChromeAndroid()) {\n      !this.isReadOnly() && this.inputHandler.handlePaste(event);\n    }\n  }\n\n  @HostListener(\"drop\", [\"$event\"])\n  handleDrop(event: any) {\n    if (!this.isChromeAndroid()) {\n      event.preventDefault();\n    }\n  }\n\n  isChromeAndroid(): boolean {\n    return /chrome/i.test(navigator.userAgent) && /android/i.test(navigator.userAgent);\n  }\n\n  isReadOnly(): boolean {\n    return this.elementRef.nativeElement.hasAttribute('readonly')\n  }\n\n  registerOnChange(callbackFunction: Function): void {\n    this.inputHandler.setOnModelChange(callbackFunction);\n  }\n\n  registerOnTouched(callbackFunction: Function): void {\n    this.inputHandler.setOnModelTouched(callbackFunction);\n  }\n\n  setDisabledState(value: boolean): void {\n    this.elementRef.nativeElement.disabled = value;\n  }\n\n  writeValue(value: number): void {\n    this.inputHandler.setValue(value);\n  }\n}\n","import {ModuleWithProviders, NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {FormsModule} from '@angular/forms';\nimport {CurrencyMaskDirective} from \"./currency-mask.directive\";\nimport {CURRENCY_MASK_CONFIG, CurrencyMaskConfig} from \"./currency-mask.config\";\n\n@NgModule({\n  imports: [ CommonModule, FormsModule ],\n  declarations: [ CurrencyMaskDirective ],\n  exports: [ CurrencyMaskDirective ]\n})\nexport class NgxCurrencyModule {\n  static forRoot(config: CurrencyMaskConfig): ModuleWithProviders<NgxCurrencyModule> {\n    return {\n      ngModule: NgxCurrencyModule,\n      providers: [{\n        provide: CURRENCY_MASK_CONFIG,\n        useValue: config,\n      }]\n    }\n  }\n}\n"]}