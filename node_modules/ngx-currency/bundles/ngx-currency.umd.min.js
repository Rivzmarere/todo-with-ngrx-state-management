!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/forms"),require("@angular/common")):"function"==typeof define&&define.amd?define("ngx-currency",["exports","@angular/core","@angular/forms","@angular/common"],t):t((e=e||self)["ngx-currency"]={},e.ng.core,e.ng.forms,e.ng.common)}(this,(function(e,t,n,i){"use strict";var r;(r=e.CurrencyMaskInputMode||(e.CurrencyMaskInputMode={}))[r.FINANCIAL=0]="FINANCIAL",r[r.NATURAL=1]="NATURAL";var s=new t.InjectionToken("currency.mask.config"),a=function(){function e(e){this.htmlInputElement=e}return e.prototype.setCursorAt=function(e){if(this.htmlInputElement.setSelectionRange)this.htmlInputElement.focus(),this.htmlInputElement.setSelectionRange(e,e);else if(this.htmlInputElement.createTextRange){var t=this.htmlInputElement.createTextRange();t.collapse(!0),t.moveEnd("character",e),t.moveStart("character",e),t.select()}},e.prototype.updateValueAndCursor=function(e,t,n){this.rawValue=e,n-=t-e.length,this.setCursorAt(n)},Object.defineProperty(e.prototype,"canInputMoreNumbers",{get:function(){var e=!(this.rawValue.replace(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g,"").length>=this.htmlInputElement.maxLength&&this.htmlInputElement.maxLength>=0),t=this.inputSelection.selectionStart,n=this.inputSelection.selectionEnd,i=!(t==n||!this.htmlInputElement.value.substring(t,n).match(/[^0-9\u0660-\u0669\u06F0-\u06F9]/)),r="0"==this.htmlInputElement.value.substring(0,1);return e||i||r},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputSelection",{get:function(){var e=0,t=0;if("number"==typeof this.htmlInputElement.selectionStart&&"number"==typeof this.htmlInputElement.selectionEnd)e=this.htmlInputElement.selectionStart,t=this.htmlInputElement.selectionEnd;else{var n=document.selection.createRange();if(n&&n.parentElement()==this.htmlInputElement){var i=this.htmlInputElement.value.length,r=this.htmlInputElement.value.replace(/\r\n/g,"\n"),s=this.htmlInputElement.createTextRange();s.moveToBookmark(n.getBookmark());var a=this.htmlInputElement.createTextRange();a.collapse(!1),s.compareEndPoints("StartToEnd",a)>-1?e=t=i:(e=-s.moveStart("character",-i),e+=r.slice(0,e).split("\n").length-1,s.compareEndPoints("EndToEnd",a)>-1?t=i:(t=-s.moveEnd("character",-i),t+=r.slice(0,t).split("\n").length-1))}}return{selectionStart:e,selectionEnd:t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawValue",{get:function(){return this.htmlInputElement&&this.htmlInputElement.value},set:function(e){this._storedRawValue=e,this.htmlInputElement&&(this.htmlInputElement.value=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storedRawValue",{get:function(){return this._storedRawValue||""},enumerable:!1,configurable:!0}),e}(),o=function(){function t(e,t){this.htmlInputElement=e,this.options=t,this.SINGLE_DIGIT_REGEX=new RegExp(/^[0-9\u0660-\u0669\u06F0-\u06F9]$/),this.ONLY_NUMBERS_REGEX=new RegExp(/[^0-9\u0660-\u0669\u06F0-\u06F9]/g),this.PER_AR_NUMBER=new Map,this.inputManager=new a(e),this.initialize()}return t.prototype.initialize=function(){this.PER_AR_NUMBER.set("۰","0"),this.PER_AR_NUMBER.set("۱","1"),this.PER_AR_NUMBER.set("۲","2"),this.PER_AR_NUMBER.set("۳","3"),this.PER_AR_NUMBER.set("۴","4"),this.PER_AR_NUMBER.set("۵","5"),this.PER_AR_NUMBER.set("۶","6"),this.PER_AR_NUMBER.set("۷","7"),this.PER_AR_NUMBER.set("۸","8"),this.PER_AR_NUMBER.set("۹","9"),this.PER_AR_NUMBER.set("٠","0"),this.PER_AR_NUMBER.set("١","1"),this.PER_AR_NUMBER.set("٢","2"),this.PER_AR_NUMBER.set("٣","3"),this.PER_AR_NUMBER.set("٤","4"),this.PER_AR_NUMBER.set("٥","5"),this.PER_AR_NUMBER.set("٦","6"),this.PER_AR_NUMBER.set("٧","7"),this.PER_AR_NUMBER.set("٨","8"),this.PER_AR_NUMBER.set("٩","9")},t.prototype.addNumber=function(t){var n=this.options,i=n.decimal,r=n.precision,s=n.inputMode,a=String.fromCharCode(t),o=a===this.options.decimal;if(this.rawValue){f=this.inputSelection.selectionStart;var u=this.inputSelection.selectionEnd,l=this.rawValue.substring(0,f),p=this.rawValue.substring(u,this.rawValue.length),h=-1!==l.indexOf(i);s===e.CurrencyMaskInputMode.NATURAL&&h&&f===u&&(p=p.substring(1));var c=l+a+p,d=f+1;if((o||a===this.options.thousands)&&a===p[0])d++;else if(!this.SINGLE_DIGIT_REGEX.test(a))return;this.rawValue=c,this.updateFieldValue(d)}else{this.rawValue=this.applyMask(!1,a);var f=void 0;s===e.CurrencyMaskInputMode.NATURAL&&r>0&&(f=this.rawValue.indexOf(i),o&&f++),this.updateFieldValue(f)}},t.prototype.applyMask=function(t,n,i){void 0===i&&(i=!1);var r=this.options,s=r.allowNegative,a=r.decimal,o=r.precision,u=r.prefix,l=r.suffix,p=r.thousands,h=r.min,c=r.max,d=r.inputMode,f=(n=t?new Number(n).toFixed(o):n).replace(this.ONLY_NUMBERS_REGEX,"");if(!f&&n!==a)return"";d!==e.CurrencyMaskInputMode.NATURAL||t||i||(f=(n=this.padOrTrimPrecision(n)).replace(this.ONLY_NUMBERS_REGEX,""));var g=f.slice(0,f.length-o).replace(/^\u0660*/g,"").replace(/^\u06F0*/g,"").replace(/^0*/g,"");""==g&&(g="0");var m=parseInt(g);g=g.replace(/\B(?=([0-9\u0660-\u0669\u06F0-\u06F9]{3})+(?![0-9\u0660-\u0669\u06F0-\u06F9]))/g,p),p&&g.startsWith(p)&&(g=g.substring(1));var y=g,v=f.slice(f.length-o),E=parseInt(v)||0,R=n.indexOf("-")>-1;c=this.isNullOrUndefined(c)||this.isNullOrUndefined(h)?c:Math.max(c,h);var M=m+E/100;return M=R?-M:M,!this.isNullOrUndefined(c)&&M>c?this.applyMask(!0,c+""):!this.isNullOrUndefined(h)&&M<h?this.applyMask(!0,h+""):(o>0&&("0"==y&&v.length<o?y+=a+"0".repeat(o-1)+v:y+=a+v),(R&&s&&!(0==M)?"-":"")+u+y+l)},t.prototype.padOrTrimPrecision=function(e){var t=this.options,n=t.decimal,i=t.precision,r=e.lastIndexOf(n);-1===r&&(r=e.length,e+=n);var s=e.substring(r).replace(this.ONLY_NUMBERS_REGEX,""),a=s.length;if(a<i)for(var o=a;o<i;o++)s+="0";else a>i&&(s=s.substring(0,s.length+i-a));return e.substring(0,r)+n+s},t.prototype.clearMask=function(e){if(this.isNullable()&&""===e)return null;var t=(e||"0").replace(this.options.prefix,"").replace(this.options.suffix,"");return this.options.thousands&&(t=t.replace(new RegExp("\\"+this.options.thousands,"g"),"")),this.options.decimal&&(t=t.replace(this.options.decimal,".")),this.PER_AR_NUMBER.forEach((function(e,n){var i=new RegExp(n,"g");t=t.replace(i,e)})),parseFloat(t)},t.prototype.changeToNegative=function(){this.options.allowNegative&&""!=this.rawValue&&"-"!=this.rawValue.charAt(0)&&0!=this.value&&(this.rawValue=this.applyMask(!1,"-"+this.rawValue))},t.prototype.changeToPositive=function(){this.rawValue=this.applyMask(!1,this.rawValue.replace("-",""))},t.prototype.removeNumber=function(t){var n=this.options,i=n.decimal,r=n.thousands,s=n.prefix,a=n.suffix,o=n.inputMode;if(this.isNullable()&&0==this.value)this.rawValue=null;else{var u=this.inputSelection.selectionEnd,l=this.inputSelection.selectionStart,p=this.rawValue.length-a.length;if(u=Math.min(p,Math.max(u,s.length)),(l=Math.min(p,Math.max(l,s.length)))!==u||this.inputSelection.selectionStart===this.inputSelection.selectionEnd){var h=this.rawValue.indexOf(i);-1===h&&(h=this.rawValue.length);var c=0,d="",f=h<u,g=h+1===u;if(u===l)if(8==t){if(l<=s.length)return;l--,this.rawValue.substr(l,1).match(/\d/)||l--,o===e.CurrencyMaskInputMode.NATURAL&&f&&(c=-1,g&&this.value<10&&this.value>-10&&(d+="0"))}else if(46==t||63272==t){if(l===p)return;u++,this.rawValue.substr(l,1).match(/\d/)||(l++,u++)}if(o===e.CurrencyMaskInputMode.NATURAL&&l>h)for(var m=u-l,y=0;y<m;y++)d+="0";var v=this.rawValue.length-u;this.rawValue=this.rawValue.substring(0,l)+d+this.rawValue.substring(u),this.rawValue.substr(s.length,1)===r&&(this.rawValue=this.rawValue.substring(0,s.length)+this.rawValue.substring(s.length+1),v=Math.min(v,this.rawValue.length-s.length)),this.updateFieldValue(this.rawValue.length-v+c,!0)}else this.updateFieldValue(l)}},t.prototype.updateFieldValue=function(e,t){void 0===t&&(t=!1);var n=this.applyMask(!1,this.rawValue||"",t);e=null==e?this.rawValue.length:e,e=Math.max(this.options.prefix.length,Math.min(e,this.rawValue.length-this.options.suffix.length)),this.inputManager.updateValueAndCursor(n,this.rawValue.length,e)},t.prototype.updateOptions=function(e){var t=this.value;this.options=e,this.value=t},t.prototype.prefixLength=function(){return this.options.prefix.length},t.prototype.suffixLength=function(){return this.options.suffix.length},t.prototype.isNullable=function(){return this.options.nullable},Object.defineProperty(t.prototype,"canInputMoreNumbers",{get:function(){return this.inputManager.canInputMoreNumbers},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputSelection",{get:function(){return this.inputManager.inputSelection},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rawValue",{get:function(){return this.inputManager.rawValue},set:function(e){this.inputManager.rawValue=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storedRawValue",{get:function(){return this.inputManager.storedRawValue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.clearMask(this.rawValue)},set:function(e){this.rawValue=this.applyMask(!0,""+e)},enumerable:!1,configurable:!0}),t.prototype.isNullOrUndefined=function(e){return null==e},t}(),u=function(){function e(e,t){this.inputService=new o(e,t)}return e.prototype.handleCut=function(e){var t=this;setTimeout((function(){t.inputService.updateFieldValue(),t.setValue(t.inputService.value),t.onModelChange(t.inputService.value)}),0)},e.prototype.handleInput=function(e){var t=this,n=this.inputService.inputSelection.selectionStart,i=this.inputService.rawValue.charCodeAt(n-1),r=this.inputService.rawValue.length,s=this.inputService.storedRawValue.length;if(1!=Math.abs(r-s))return this.inputService.updateFieldValue(n),void this.onModelChange(this.inputService.value);this.inputService.rawValue=this.inputService.storedRawValue,r<s&&this.timer((function(){t.inputService.updateFieldValue(n+1),t.inputService.removeNumber(8),t.onModelChange(t.inputService.value)}),0),r>s&&(this.inputService.updateFieldValue(n-1),this.handleKeypressImpl(i))},e.prototype.handleKeydown=function(e){var t=e.which||e.charCode||e.keyCode;8!=t&&46!=t&&63272!=t||(e.preventDefault(),this.inputService.inputSelection.selectionStart<=this.inputService.prefixLength()&&this.inputService.inputSelection.selectionEnd>=this.inputService.rawValue.length-this.inputService.suffixLength()?this.clearValue():(this.inputService.removeNumber(t),this.onModelChange(this.inputService.value)))},e.prototype.clearValue=function(){this.setValue(this.inputService.isNullable()?null:0),this.onModelChange(this.inputService.value)},e.prototype.handleKeypress=function(e){var t=e.which||e.charCode||e.keyCode;e.preventDefault(),97===t&&e.ctrlKey||this.handleKeypressImpl(t)},e.prototype.handleKeypressImpl=function(e){switch(e){case void 0:case 9:case 13:return;case 43:this.inputService.changeToPositive();break;case 45:this.inputService.changeToNegative();break;default:if(this.inputService.canInputMoreNumbers)Math.abs(this.inputService.inputSelection.selectionEnd-this.inputService.inputSelection.selectionStart)==this.inputService.rawValue.length&&this.setValue(null),this.inputService.addNumber(e)}this.onModelChange(this.inputService.value)},e.prototype.handlePaste=function(e){var t=this;setTimeout((function(){t.inputService.updateFieldValue(),t.setValue(t.inputService.value),t.onModelChange(t.inputService.value)}),1)},e.prototype.updateOptions=function(e){this.inputService.updateOptions(e)},e.prototype.getOnModelChange=function(){return this.onModelChange},e.prototype.setOnModelChange=function(e){this.onModelChange=e},e.prototype.getOnModelTouched=function(){return this.onModelTouched},e.prototype.setOnModelTouched=function(e){this.onModelTouched=e},e.prototype.setValue=function(e){this.inputService.value=e},e.prototype.timer=function(e,t){setTimeout(e,t)},e}(),l={provide:n.NG_VALUE_ACCESSOR,useExisting:t.forwardRef((function(){return p})),multi:!0},p=function(){function n(t,n,i){this.currencyMaskConfig=t,this.elementRef=n,this.keyValueDiffers=i,this.options={},this.optionsTemplate={align:"right",allowNegative:!0,allowZero:!0,decimal:".",precision:2,prefix:"$ ",suffix:"",thousands:",",nullable:!1,inputMode:e.CurrencyMaskInputMode.FINANCIAL},t&&(this.optionsTemplate=t),this.keyValueDiffer=i.find({}).create()}return n.prototype.ngAfterViewInit=function(){this.elementRef.nativeElement.style.textAlign=this.options&&this.options.align?this.options.align:this.optionsTemplate.align},n.prototype.ngDoCheck=function(){this.keyValueDiffer.diff(this.options)&&(this.elementRef.nativeElement.style.textAlign=this.options.align?this.options.align:this.optionsTemplate.align,this.inputHandler.updateOptions(Object.assign({},this.optionsTemplate,this.options)))},n.prototype.ngOnInit=function(){this.inputHandler=new u(this.elementRef.nativeElement,Object.assign({},this.optionsTemplate,this.options))},n.prototype.handleBlur=function(e){this.inputHandler.getOnModelTouched().apply(e)},n.prototype.handleCut=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleCut(e)},n.prototype.handleInput=function(e){this.isChromeAndroid()&&!this.isReadOnly()&&this.inputHandler.handleInput(e)},n.prototype.handleKeydown=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleKeydown(e)},n.prototype.handleKeypress=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handleKeypress(e)},n.prototype.handlePaste=function(e){this.isChromeAndroid()||!this.isReadOnly()&&this.inputHandler.handlePaste(e)},n.prototype.handleDrop=function(e){this.isChromeAndroid()||e.preventDefault()},n.prototype.isChromeAndroid=function(){return/chrome/i.test(navigator.userAgent)&&/android/i.test(navigator.userAgent)},n.prototype.isReadOnly=function(){return this.elementRef.nativeElement.hasAttribute("readonly")},n.prototype.registerOnChange=function(e){this.inputHandler.setOnModelChange(e)},n.prototype.registerOnTouched=function(e){this.inputHandler.setOnModelTouched(e)},n.prototype.setDisabledState=function(e){this.elementRef.nativeElement.disabled=e},n.prototype.writeValue=function(e){this.inputHandler.setValue(e)},n.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[s]}]},{type:t.ElementRef},{type:t.KeyValueDiffers}]},n.decorators=[{type:t.Directive,args:[{selector:"[currencyMask]",providers:[l]}]}],n.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[s]}]},{type:t.ElementRef},{type:t.KeyValueDiffers}]},n.propDecorators={options:[{type:t.Input}],handleBlur:[{type:t.HostListener,args:["blur",["$event"]]}],handleCut:[{type:t.HostListener,args:["cut",["$event"]]}],handleInput:[{type:t.HostListener,args:["input",["$event"]]}],handleKeydown:[{type:t.HostListener,args:["keydown",["$event"]]}],handleKeypress:[{type:t.HostListener,args:["keypress",["$event"]]}],handlePaste:[{type:t.HostListener,args:["paste",["$event"]]}],handleDrop:[{type:t.HostListener,args:["drop",["$event"]]}]},n}(),h=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:s,useValue:t}]}},e.decorators=[{type:t.NgModule,args:[{imports:[i.CommonModule,n.FormsModule],declarations:[p],exports:[p]}]}],e}();e.CURRENCYMASKDIRECTIVE_VALUE_ACCESSOR=l,e.CurrencyMaskDirective=p,e.NgxCurrencyModule=h,e.ɵa=s,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-currency.umd.min.js.map